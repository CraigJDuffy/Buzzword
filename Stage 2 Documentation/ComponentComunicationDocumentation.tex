\documentclass[12pt, a4paper]{article}

\usepackage[utf8]{inputenc}

\usepackage{minted} % Look at the pretty colours, and indenting, and wrapping...
\setminted{autogobble, breakautoindent, breaklines}
\AtBeginEnvironment{minted}{
  \renewcommand{\fcolorbox}[4][]{#4}} % prevents red error box appearing for parsing errors

\usepackage[colorlinks=true,urlcolor=magenta, linkcolor=red]{hyperref} %Gabbay'fy the URLs (and make them colored text rather than those stupid boxes)

\def\sectionautorefname{Section}
\def\subsectionautorefname{Subsection} % Reassigning the default names to have capitals.

%The command gives hyperlinked referencings in the form Section #: SectionTitle
\newcommand{\gref}[1]{\hyperref[#1]{\autoref*{#1}: \nameref{#1}}} % Good referencing = gref

\usepackage{tabulary} %used for tables.
\usepackage{booktabs} %Used for nicer table formatting eg midrule

\begin{document}
\title{Component Intercommunication Specification}
\author{Tommy Lamb}

\maketitle

\tableofcontents
\pagebreak


\section{Server API}

\subsection{General Comments}

The server scripts follow standard \href{https://en.wikipedia.org/wiki/List_of_HTTP_status_codes}{HTTP status codes}. In the case of a bad request (eg missing arguments) it will return status code 400. Where the server encounters an error, 500 is returned. These include errors in retrieving data from the database, which \textit{may} be due to invalid argument values being supplied.

As yet, the server does not check how many results are returned from the database. This means it may return invalid, empty JSON objects where the supplied arguments don't correspond to a database entry. Where more than one result is returned by the database, no guarantees are made as to which result is ultimately returned.

In accessing the server scripts, it is necessary that the requesting code also be running on the MACS departmental server. In practice this means the various components can only be tested on the server, rather than on local machines. Copying the files to another PHP-compatible server instance may negate this requirement. Failing to do so will generate a JavaScript error on the browser console which mentions the \href{https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin}{Access-Control-Allow-Origin} response header. It may be possible to remove this requirement; investigation ongoing.

\paragraph{Example Request}
\begin{minted}{javascript}
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200){
		console.log(this.responseText);
	} else if (this.readyState==4 && (this.status==500||this.status==400)){
		//Error Handling here
	}
};
	xhttp.open("POST", "GetCustomerOrder.php" , true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send("OrderName=Pond&OrderNumber=12");
\end{minted}

\subsection{Customer Component}

\subsubsection{GetCustomerOrder.php}

\begin{tabulary}{\textwidth}{LL}
Request Type: & POST\\
Argument List: & OrderName\\
&OrderNumber\\
Returns: & JSON: \hyperref[subsec:Order]{Order object}\\
URL: & \\
\multicolumn{2}{c}{\verb|www2.macs.hw.ac.uk/~til1/ThirdYear/GroupProject/Customer/GetCustomerOrder.php|}
\\
\end{tabulary}


\subsection{Waiting Component}

\subsubsection{GetMenu.php}
\begin{tabulary}{\textwidth}{LL}
Request Type: & POST\\
Argument List: & MenuID\\
Returns: & JSON: \hyperref[subsec:Menu]{Menu object}\\
URL: & \\
\multicolumn{2}{c}{\verb|www2.macs.hw.ac.uk/~til1/ThirdYear/GroupProject/Waiting/GetMenu.php|}
\\
\end{tabulary}


\section{JSON Specification}

\subsection{Menu}\label{subsec:Menu}

\begin{itemize}
\item The Menu object primarily consists of a tree of two other objects: \nameref{subsubsec:MenuItem} and \nameref{subsubsec:MenuSection}

\item MenuID is the globally unique identifier for this menu object

\item DisplayName is the string to be used if representing the object to a user

\item Sections is a list of the top-level MenuSection objects that comprises this menu object. Examples may include MenuSection objects representing Starters, Mains, Deserts, or Drinks.
\end{itemize}

\begin{minted}{json}
Menu : {
	"MenuID" : int,
	"DisplayName" : string,
	"Sections" : [MenuSection, MenuSection, ...]
}
\end{minted}


\subsubsection{Menu Item} \label{subsubsec:MenuItem}

\begin{itemize}
\item Represents any single 'thing' that can be ordered by a customer.
\item The ItemID is a globablly unique identifier for the specific item.
\item ParentSectionID is the globally unique identifier for the menu section under which this item is listed.
\item DisplayName is the string to be used if representing the object to a user
\item Description is a textual description of the object, eg \textit{Decadent chocolate Bombe glac√©e drizzled with toffee sauce and served with black forest fruit compote.}
\item Price is the decimal value representing the price of the item to the customer ordering.
\end{itemize}

\begin{minted}{json}
MenuItem : {
	"ItemID" : int,
	"ParentSectionID" : int,
	"DisplayName" : string,
	"Description" : string,
	"Price" : decimal
}
\end{minted}


\subsubsection{Menu Section}\label{subsubsec:MenuSection}

\begin{itemize}
\item Represents a section of the menu, which may contain either a number of subsections, or a number of menu items.
\item ParentSectionID is the globally unique identifier for the menu section under which this section is listed.
\item ParentSectionID may be null if the section is a top-level element. That is, child only to the Menu object.
\item GroupColour is a string containing a colour hex code, eg "\#FFFFFF"
\item HasItems represents whether the section has items (true) or subsections (false).
\item Behaviour where both Items and Subsections are specified is as yet undefined. 
\end{itemize}

\begin{minted}{json}
MenuSection : {
	"SectionID" : int,
	"ParentSectionID" : int,
	"DisplayName" : string,
	"GroupColour" : string,
	"HasItems" : Boolean,
	["Items" : [MenuItem, MenuItem, ...]],
	["Subsections" : [MenuSection, MenuSection, ...]]
}
\end{minted}


\pagebreak
\subsection{Order}\label{subsec:Order}

\begin{itemize}
\item Represents an order as placed by a customer (by any means).
\item OrderNumber is a number that can be used to geographically locate the customer and/or to group orders entered separately. For example, a table number.
For grouping separate orders, this allows orders to be placed separately from a group of people, but have those orders conceptually grouped in the system to allow better customer service (eg have all orders prepared at the same time).
\item Items is the list of OrderItem objects that this order consists of.
\item ETA is either the string HH:MM representing the estimated time of completion for the order, or null if no such estimate exists.
\end{itemize}

\begin{minted}{json}
Order : {
	"OrderNumber" : int,
	"OrderName" : string,
	"ETA" :  string | null,
	"Items" : [OrderItem, OrderItem, ...],
}
\end{minted}
\pagebreak
\subsubsection{Order Item}\label{subsubsec:OrderItem}

\begin{itemize}
\item Represents a single type of MenuItem ordered by a customer.
\item Amount is the non-zero integer representing how many of the MenuItem the customer has ordered.
\item Request is a potentially empty string which represents any specific requests or choices made by the customer (as under F-UR-1.4 and related Non-Functional requirements)
\item MenuItem is the JSON object specified above representing the thing being ordered.
\item ETA is either the string HH:MM representing the estimated time of completion for this item, or null if no such estimate exists.
\item GroupNumber is an integer used to group items within an order. This allows the system to handle starters, mains, and deserts being specified within one order but handled individually (IE served separately).
\item The Modified flag must be specified for \underline{all} items if the Order object is being used in the context of changing the details of an existing order. The value of the flag is determined as follows:
\subitem 0 : Item has been added to order
\subitem 1 : Item details have changed (one or more of: Amount, Request, GroupNumber)
\subitem 2 : Item ETA has been changed (including to/from null)
\subitem 3 : Item has been removed from the order

When changing an order, the \textit{MenuItem} field must remain unchanged within the \textit{OrderItem} object. To change an item in the order, the original \textit{OrderItem} object should be included with the \textit{Modified} flag set to 2 (removed), and the new OrderItem object listed with \textit{Modified} flag set to 0 (added).
\end{itemize}

\begin{minted}{json}
OrderItem : {
	"Amount" : int,
	"Request" : string,
	"MenuItem" : MenuItem,
	"ETA" : string | null,
	"GroupNumber" : int,
	["Modified" : int]
}
\end{minted}
\end{document}